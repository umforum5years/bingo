<div class="p-4">
  <div class="flex gap-2 mb-4">
    <p-button label="–í—ã–±—Ä–∞—Ç—å —Ç—Ä–µ–∫–∏" icon="pi pi-music" (onClick)="selectTracks()" />
    <p-button
      label="–ù–∞–∑–Ω–∞—á–∏—Ç—å –Ω–æ–º–µ—Ä–∞"
      icon="pi pi-sort-amount-up"
      (onClick)="assignNumbers()"
      [disabled]="artists().length === 0"
    />
    <p-button
      label="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–ø–∏—Å–æ–∫ (json)"
      icon="pi pi-download"
      (onClick)="saveArtists()"
      [disabled]="artists().length === 0"
    />
    <p-button
      label="–ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ (json)"
      icon="pi pi-upload"
      (onClick)="loadArtists()"
    />
    <p-button
      label="–ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ (txt)"
      icon="pi pi-file"
      (onClick)="loadArtistsTxt()"
    />
    <p-button
      label="–°–∫–∞—á–∞—Ç—å —Å–ø–∏—Å–æ–∫ (txt)"
      icon="pi pi-file"
      (onClick)="downloadArtistsTxt()"
      [disabled]="artists().length === 0"
    />
  </div>

  <input
    id="fileInput"
    type="file"
    accept=".mp3"
    multiple
    (change)="onFileSelect($event)"
    class="hidden"
  />

  <input
    id="loadFileInput"
    type="file"
    accept=".json"
    (change)="onFileLoad($event)"
    class="hidden"
  />

  <input
    id="loadTxtFileInput"
    type="file"
    accept=".txt"
    (change)="onTxtFileLoad($event)"
    class="hidden"
  />

  @if (artists().length > 0) {
    <p-table
      #dt
      [value]="artists()"
      [tableStyle]="{ 'min-width': '20rem' }"
      [paginator]="true"
      [rows]="10"
      [rowsPerPageOptions]="[10, 25, 50, 100]"
      [scrollable]="true"
      scrollHeight="400px"
      [globalFilterFields]="['number', 'name']"
    >
      <ng-template #caption>
        <div class="flex justify-between items-center">
          <span>–í—Å–µ–≥–æ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π: {{ artists().length }}</span>
          <p-iconfield>
            <p-inputicon styleClass="pi pi-search" />
            <input
              pInputText
              type="text"
              (input)="filterGlobal($event, 'contains')"
              placeholder="–ü–æ–∏—Å–∫..."
            />
          </p-iconfield>
        </div>
      </ng-template>
      <ng-template #header>
        <tr>
          <th pSortableColumn="number">
            ‚Ññ <p-sortIcon field="number" />
          </th>
          <th pSortableColumn="name">
            –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å <p-sortIcon field="name" />
          </th>
        </tr>
      </ng-template>
      <ng-template #body let-artist>
        <tr>
          <td>{{ artist.number ?? '-' }}</td>
          <td>{{ artist.name }}</td>
        </tr>
      </ng-template>
    </p-table>
  }

  <hr class="my-6" />

  <h2 class="text-xl font-semibold mb-4">–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±–ª–∞–Ω–∫–æ–≤ –ë–∏–Ω–≥–æ</h2>

  <div class="flex flex-wrap gap-4 mb-4 items-end">
    <div>
      <label class="block text-sm font-medium mb-1">–†–∞–∑–º–µ—Ä —Å–µ—Ç–∫–∏</label>
      <p-select
        [options]="gridSizes"
        [(ngModel)]="gridSize"
        optionLabel="label"
        optionValue="value"
        [disabled]="useCustomGrid()"
        placeholder="–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–º–µ—Ä"
      />
    </div>

    <div class="flex items-center gap-2 mb-4">
<input
  type="checkbox"
  id="customGrid"
  [checked]="useCustomGrid()"
  (change)="useCustomGrid.set($event.target?.checked ?? false)"
  class="w-4 h-4"
/>
      <label for="customGrid" class="text-sm font-medium">–°–≤–æ–π —Ä–∞–∑–º–µ—Ä</label>
    </div>

    @if (useCustomGrid()) {
      <div>
        <label class="block text-sm font-medium mb-1">–†–∞–∑–º–µ—Ä</label>
        <p-inputnumber
          [(ngModel)]="customGridSize"
          [min]="2"
          [max]="20"
          placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 12"
        />
      </div>
    }

    <div>
      <label class="block text-sm font-medium mb-1">–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ</label>
      <p-select
        [options]="displayModes"
        [(ngModel)]="displayMode"
        optionLabel="label"
        optionValue="value"
        placeholder="–†–µ–∂–∏–º"
      />
    </div>

    <div>
      <label class="block text-sm font-medium mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–∞–Ω–∫–æ–≤</label>
      <p-inputnumber
        [(ngModel)]="cardCount"
        [min]="1"
        [max]="100"
        placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 5"
      />
    </div>

  </div>

  <div class="flex gap-2 mb-4">
    <p-button
      label="–°–æ–∑–¥–∞—Ç—å –±–ª–∞–Ω–∫–∏"
      icon="pi pi-plus"
      (onClick)="generateBingoCards()"
      [disabled]="artists().filter(a => a.number !== null).length === 0"
    />
    @if (bingoCards().length > 0) {
      <div class="flex gap-2 flex-wrap">
        <p-button
          label="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ Word"
          icon="pi pi-file-word"
          severity="primary"
          (onClick)="saveToWord()"
        />
        <p-button
          label="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ JSON"
          icon="pi pi-save"
          severity="success"
          (onClick)="saveBingoCardsJson()"
        />
        <p-button
          label="–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ JSON"
          icon="pi pi-upload"
          severity="info"
          (onClick)="loadBingoCardsJson()"
        />
        <p-button
          label="–û—á–∏—Å—Ç–∏—Ç—å"
          icon="pi pi-trash"
          severity="danger"
          (onClick)="clearBingoCards()"
        />
      </div>

      <div class="orientation-selector">
        <label class="block text-sm font-medium mb-2">–û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã:</label>
        <div class="flex gap-2">
          <button
            type="button"
            class="orientation-btn"
            [class.active]="pageOrientation() === 'portrait'"
            (click)="pageOrientation.set('portrait')"
          >
            <span class="orientation-icon portrait">üìÑ</span>
            <span>–ü–æ—Ä—Ç—Ä–µ—Ç–Ω–∞—è</span>
          </button>
          <button
            type="button"
            class="orientation-btn"
            [class.active]="pageOrientation() === 'landscape'"
            (click)="pageOrientation.set('landscape')"
          >
            <span class="orientation-icon landscape">üìÑ</span>
            <span>–ê–ª—å–±–æ–º–Ω–∞—è</span>
          </button>
        </div>
      </div>
    }
  </div>

  <input
    type="file"
    id="loadCardsFileInput"
    accept=".json"
    (change)="onCardsFileLoad($event)"
    style="display: none"
  />

  @if (bingoCards().length > 0) {
    <div class="bingo-cards-container">
      @for (card of bingoCards(); track card.id) {
        <div class="bingo-card">
          <div class="bingo-card-header">
            <span class="bingo-card-number">–ë–ª–∞–Ω–∫ ‚Ññ{{ card.id }}</span>
            <span class="bingo-card-size">{{ getEffectiveGridSize() }}x{{ getEffectiveGridSize() }}</span>
          </div>
          <div
            class="bingo-grid"
            [style.grid-template-columns]="'repeat(' + getEffectiveGridSize() + ', 1fr)'"
          >
            @for (cell of card.cells; track cell.number) {
              <div class="bingo-cell">
                <span class="bingo-cell-content">{{ getCellDisplay(cell) }}</span>
              </div>
            }
          </div>
        </div>
      }
    </div>
  }
</div>
